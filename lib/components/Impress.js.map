{"version":3,"sources":["../../src/components/Impress.js"],"names":["body","document","ua","navigator","userAgent","toLowerCase","defaults","width","height","maxScale","minScale","perspective","transitionDuration","rootStyles","position","top","left","transformOrigin","transition","transformStyle","windowScale","config","_impressSupported","_lastHash","_stepsData","_activeStep","Impress","props","state","activeStep","stepsData","canvasStyles","currentState","x","y","z","rotateX","rotateY","rotateZ","scale","rootData","init","setState","$set","goto","addEventListener","e","keyCode","prev","next","window","location","hash","removeEventListener","event","console","log","classList","dataset","search","className","remove","add","documentElement","style","overflow","$merge","step","id","data","duration","scrollTo","target","zoomin","delay","targetScale","transform","transitionDelay","stepsDataEntries","Object","entries","findIndex","k","v","length","index","cloneElement","key","initStep","bind","children","steps","Children","map","stepComponent"],"mappings":"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","file":"Impress.js","sourcesContent":["import React, { Component } from 'react';\nimport update from 'react/lib/update';\nimport { toNumber, computeWindowScale, css, pfx, perspective, \n         translate, rotate, scale, throttle, getElementFromHash } from './util';\n\nconst body = document.body,\n      ua = navigator.userAgent.toLowerCase();\n      \nconst defaults = {\n    width: 1024,\n    height: 768,\n    maxScale: 1,\n    minScale: 0,\n    perspective: 1000,\n    transitionDuration: 1000\n};\n\nconst rootStyles = {\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transformOrigin: \"top left\",\n    transition: \"all 0s ease-in-out\",\n    transformStyle: \"preserve-3d\"\n};\n\nlet windowScale = null,\n    config = null;\n    \nlet _impressSupported,\n    _lastHash = \"\",\n    _stepsData = {},\n    _activeStep;\n\nexport default class Impress extends Component {\n    constructor(props){\n        super(props);\n        \n        // impress & canvas state\n        this.state = {\n            activeStep: {},\n            stepsData: {},\n            rootStyles,\n            canvasStyles: rootStyles,\n            currentState: {\n                x: 0, y: 0, z: 0,\n                rotateX: 0, rotateY: 0, rotateZ: 0,\n                scale: 1\n            }\n        };\n    }\n    componentWillMount(){\n        // Init impress\n        const { rootData } = this.props;\n        this.init( rootData || {} );\n    }\n    componentDidMount(){\n        this.setState( update( this.state, {\n            activeStep: {\n                $set: _activeStep\n            },\n            stepsData: {\n                $set: _stepsData\n            }\n        }));\n        \n        // 2017/2/28 暫時想不到好方法\n        this.goto( _activeStep, 500 );\n        \n        document.addEventListener( \"keyup\", throttle((e) => {\n            if ( e.keyCode === 9 ||\n               ( e.keyCode >= 32 && e.keyCode <= 34 ) ||\n               ( e.keyCode >= 37 && e.keyCode <= 40 ) ) {\n                switch ( e.keyCode ) {\n                    case 33: // Page up\n                    case 37: // Left\n                    case 38: // Up\n                             this.prev();\n                             break;\n                    case 9:  // Tab\n                    case 32: // Space\n                    case 34: // Page down\n                    case 39: // Right\n                    case 40: // Down\n                             this.next();\n                             break;\n                    default:\n                        break;\n                }\n            }\n                \n            \n            //this.state.stepsData[ Object.keys( this.state.stepsData ) ]\n        }, 250), false );\n        \n        window.addEventListener( \"resize\", throttle(() => {\n            this.goto( this.state.activeStep, 500 );\n        }, 250), false );\n        \n        window.addEventListener( \"hashchange\", throttle(() => {\n            if ( window.location.hash !== _lastHash )\n                this.goto( getElementFromHash( _stepsData ), 500 );\n        }, 250), false );\n    }\n    componentWillUnmount() {\n        document.removeEventListener(\"keydown\", function( event ) {\n            console.log(event.keyCode);\n        }, false);\n    }\n    \n    init( rootData ){\n        // Check impress support or not.\n        _impressSupported =\n            // Browser should support CSS 3D transtorms\n            ( pfx( \"perspective\" ) !== null ) &&\n            // Browser should support `classList` and `dataset` APIs\n            ( body.classList ) &&\n            ( body.dataset ) &&\n            // But some mobile devices need to be blacklisted,\n            // because their CSS 3D support or hardware is not\n            // good enough to run impress.js properly, sorry...\n            ( ua.search( /(iphone)|(ipod)|(android)/ ) === -1 );\n      \n        if ( !_impressSupported ) {\n            // We can't be sure that `classList` is supported\n            body.className += \" impress-not-supported \";\n        } else {\n            body.classList.remove( \"impress-not-supported\" );\n            body.classList.add( \"impress-supported\" );\n        }\n        // Config\n        config = {\n            width: toNumber( rootData.width, defaults.width ),\n            height: toNumber( rootData.height, defaults.height ),\n            maxScale: toNumber( rootData.maxScale, defaults.maxScale ),\n            minScale: toNumber( rootData.minScale, defaults.minScale ),\n            perspective: toNumber( rootData.perspective, defaults.perspective ),\n            transitionDuration: toNumber(\n              rootData.transitionDuration, defaults.transitionDuration\n            )\n        };\n        windowScale = computeWindowScale( config );\n        // HTML height\n        document.documentElement.style.height = \"100%\";\n        // Body style\n        css( body, {\n            height: \"100%\",\n            overflow: \"hidden\"\n        } );\n        \n        this.setState( update( this.state, { \n            rootStyles: {\n                $merge: {\n                    'transform': perspective( config.perspective / windowScale ) + scale( windowScale )\n                }\n            }\n        }));\n        \n        body.classList.add( \"impress-enabled\" );\n    }\n    \n    initStep( step ){\n        if ( !_activeStep )\n            _activeStep = step;\n            \n        _stepsData = update( _stepsData, {\n            $merge: {\n                [ step.id ]: {\n                    id: step.id,\n                    className: step.className,\n                    data: step.data,\n                    duration: step.duration\n                }\n            }\n        });\n    }\n    \n    goto( step, duration = 1000 ) {\n        let { activeStep, currentState } = this.state;\n        \n        window.scrollTo(0, 0);\n        \n        if( activeStep )\n            body.classList.remove(\"impress-on-\" + activeStep.id);\n        \n        body.classList.add(\"impress-on-\" + step.id);\n        \n        let target = {\n            x: -step.data.x,\n            y: -step.data.y,\n            z: -step.data.z,\n            rotateX: -step.data.rotateX,\n            rotateY: -step.data.rotateY,\n            rotateZ: -step.data.rotateZ,\n            scale: 1 / step.data.scale\n        };\n        \n        let zoomin = target.scale >= currentState.scale;\n        \n        duration = toNumber( duration, config.transitionDuration );\n        let delay = ( duration / 2 );\n        \n        if ( step.id === activeStep.id )\n            windowScale = computeWindowScale( config );\n        \n        let targetScale = target.scale * windowScale;\n        \n        this.setState( update( this.state, {\n          activeStep: {\n              $set: step\n          },\n          currentState: {\n              $set: target\n          },\n          rootStyles: {\n              transform: {\n                  $set: perspective( config.perspective / targetScale ) + scale( targetScale ),\n              },\n              transitionDuration: {\n                  $set: duration + \"ms\"\n              },\n              transitionDelay: {\n                  $set: ( zoomin ? delay : 0 ) + \"ms\" \n              }\n          },\n          canvasStyles: {\n              transform: {\n                  $set: rotate( target, true ) + translate( target ),\n              },\n              transitionDuration: {\n                  $set: duration + \"ms\"\n              },\n              transitionDelay: {\n                  $set: ( zoomin ? 0 : delay ) + \"ms\"\n              }\n          }\n        }));\n        \n        window.location.hash = _lastHash = \"#/\" + step.id;\n    }\n    prev(){\n        const { activeStep } = this.state;\n        const stepsDataEntries = Object.entries( _stepsData );\n        let prev = stepsDataEntries.findIndex( ([k, v]) => { return k === activeStep.id } ) - 1;\n        prev = prev >= 0 ? stepsDataEntries[ prev ][1] : stepsDataEntries[ stepsDataEntries.length - 1 ][1];\n            \n        this.goto( prev, prev.duration );\n    }\n    next(){\n        const { activeStep } = this.state;\n        const stepsDataEntries = Object.entries( _stepsData );\n        let next = stepsDataEntries.findIndex( ([k, v]) => { return k === activeStep.id } ) + 1;\n        next = next < stepsDataEntries.length ? stepsDataEntries[ next ][1] : stepsDataEntries[ 0 ][1];\n            \n        this.goto( next, next.duration );\n    }\n    \n    stepComponent( step, index ){\n        const { activeStep } = this.state;\n        \n        return React.cloneElement( step, {\n                    key: index,\n                    activeStep: activeStep,\n                    initStep: this.initStep.bind(this),\n                    goto: this.goto.bind(this)\n                }, step.props.children );\n    }\n    \n    render() {\n        const { rootStyles, canvasStyles } = this.state;\n        const steps = React.Children.map( this.props.children, this.stepComponent.bind(this) );\n        \n        return (\n            <div id=\"impress\" style={ rootStyles }>\n                <div style={ canvasStyles }>\n                    {\n                        _impressSupported ?\n                        steps\n                        :\n                        <h1>Sorry, your media or browser doesn't support this.</h1>\n                    }\n                </div>\n            </div>\n        );\n    }\n}"]}